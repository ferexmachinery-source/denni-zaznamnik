<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Denní záznamník práce</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #27ae60;
            --warning-color: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .section {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        button.delete {
            background-color: var(--warning-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: var(--light-color);
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 100px;
            cursor: pointer;
        }
        
        .calendar-day:hover {
            background-color: #f0f0f0;
        }
        
        .current-date {
            background-color: var(--primary-color);
            color: white;
        }
        
        .work-entry {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        
        .nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .calendar-day {
                min-height: 70px;
                padding: 5px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Denní záznamník práce</h1>
        </header>
        
        <div class="section">
            <h2>Správa zaměstnanců</h2>
            <div class="form-group">
                <label for="employeeName">Jméno zaměstnance:</label>
                <input type="text" id="employeeName" placeholder="Zadejte jméno">
            </div>
            <button id="addEmployee">Přidat zaměstnance</button>
            
            <h3>Seznam zaměstnanců</h3>
            <table id="employeesTable">
                <thead>
                    <tr>
                        <th>Jméno</th>
                        <th>Akce</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>Kalendář</h2>
            <div class="nav">
                <button id="prevMonth">Předchozí měsíc</button>
                <h3 id="currentMonth">Leden 2023</h3>
                <button id="nextMonth">Následující měsíc</button>
            </div>
            <div class="calendar" id="calendar"></div>
        </div>
        
        <div class="section" id="dayEntriesSection" style="display: none;">
            <h2 id="selectedDateTitle">Práce pro datum: </h2>
            <div id="dayEntries"></div>
            
            <h3>Přidat záznam práce</h3>
            <div class="form-group">
                <label for="selectEmployee">Zaměstnanec:</label>
                <select id="selectEmployee"></select>
            </div>
            <div class="form-group">
                <label for="workDescription">Popis práce:</label>
                <textarea id="workDescription" rows="3" placeholder="Popište provedenou práci"></textarea>
            </div>
            <button id="addWorkEntry">Přidat záznam</button>
        </div>
        
        <div class="section">
            <h2>Export týdenního reportu</h2>
            <div class="form-group">
                <label for="reportEmployee">Zaměstnanec:</label>
                <select id="reportEmployee"></select>
            </div>
            <div class="form-group">
                <label for="reportWeek">Týden:</label>
                <input type="week" id="reportWeek">
            </div>
            <button id="generateReport">Generovat report</button>
        </div>
    </div>

    <script>
        // Konfigurace JSONBin.io
        const BIN_ID = 'YOUR_BIN_ID'; // Nahraďte skutečným ID vašeho binu
        const API_KEY = '$2a$10$YOUR_API_KEY'; // Nahraďte vaším API klíčem
        
        // Data aplikace
        let employees = [];
        let workEntries = [];
        let currentDate = new Date();
        let selectedDate = new Date();
        
        // DOM prvky
        const calendarEl = document.getElementById('calendar');
        const currentMonthEl = document.getElementById('currentMonth');
        const dayEntriesSectionEl = document.getElementById('dayEntriesSection');
        const selectedDateTitleEl = document.getElementById('selectedDateTitle');
        const dayEntriesEl = document.getElementById('dayEntries');
        const selectEmployeeEl = document.getElementById('selectEmployee');
        const reportEmployeeEl = document.getElementById('reportEmployee');
        const employeesTableEl = document.getElementById('employeesTable').querySelector('tbody');
        
        // Inicializace aplikace
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initEventListeners();
            renderCalendar();
            updateEmployeeSelects();
        });
        
        // Načtení dat z JSONBin.io
        async function loadData() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': API_KEY
                    }
                });
                
                const data = await response.json();
                employees = data.record.employees || [];
                workEntries = data.record.workEntries || [];
                
                renderEmployees();
                renderCalendar();
            } catch (error) {
                console.error('Chyba při načítání dat:', error);
            }
        }
        
        // Uložení dat na JSONBin.io
        async function saveData() {
            try {
                const data = {
                    employees,
                    workEntries
                };
                
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Chyba při ukládání dat:', error);
            }
        }
        
        // Inicializace posluchačů událostí
        function initEventListeners() {
            document.getElementById('addEmployee').addEventListener('click', addEmployee);
            document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
            document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
            document.getElementById('addWorkEntry').addEventListener('click', addWorkEntry);
            document.getElementById('generateReport').addEventListener('click', generateReport);
        }
        
        // Přidání zaměstnance
        function addEmployee() {
            const nameInput = document.getElementById('employeeName');
            const name = nameInput.value.trim();
            
            if (name && !employees.includes(name)) {
                employees.push(name);
                nameInput.value = '';
                renderEmployees();
                updateEmployeeSelects();
                saveData();
            }
        }
        
        // Smazání zaměstnance
        function deleteEmployee(index) {
            if (confirm('Opravdu chcete smazat tohoto zaměstnance?')) {
                employees.splice(index, 1);
                
                // Odstranit související záznamy práce
                workEntries = workEntries.filter(entry => entry.employeeIndex !== index);
                
                renderEmployees();
                updateEmployeeSelects();
                renderDayEntries();
                saveData();
            }
        }
        
        // Vykreslení seznamu zaměstnanců
        function renderEmployees() {
            employeesTableEl.innerHTML = '';
            
            employees.forEach((employee, index) => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = employee;
                
                const actionCell = document.createElement('td');
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Smazat';
                deleteBtn.classList.add('delete');
                deleteBtn.addEventListener('click', () => deleteEmployee(index));
                
                actionCell.appendChild(deleteBtn);
                
                row.appendChild(nameCell);
                row.appendChild(actionCell);
                
                employeesTableEl.appendChild(row);
            });
        }
        
        // Aktualizace selectů pro výběr zaměstnance
        function updateEmployeeSelects() {
            selectEmployeeEl.innerHTML = '';
            reportEmployeeEl.innerHTML = '';
            
            employees.forEach((employee, index) => {
                const option1 = document.createElement('option');
                option1.value = index;
                option1.textContent = employee;
                
                const option2 = document.createElement('option');
                option2.value = index;
                option2.textContent = employee;
                
                selectEmployeeEl.appendChild(option1);
                reportEmployeeEl.appendChild(option2);
            });
        }
        
        // Změna zobrazeného měsíce
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }
        
        // Vygenerování kalendáře
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ['Leden', 'Únor', 'Březen', 'Duben', 'Květen', 'Červen', 
                               'Červenec', 'Srpen', 'Září', 'Říjen', 'Listopad', 'Prosinec'];
            currentMonthEl.textContent = `${monthNames[month]} ${year}`;
            
            // Získat první den měsíce a poslední den měsíce
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Získat den v týdnu pro první den (0 = Neděle, 1 = Pondělí, ...)
            let firstDayOfWeek = firstDay.getDay();
            if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Neděli posuneme na konec
            firstDayOfWeek--; // Upravíme na rozsah 0-6 (Pondělí-Neděle)
            
            // Počet dní v měsíci
            const daysInMonth = lastDay.getDate();
            
            // Vyprázdnění kalendáře
            calendarEl.innerHTML = '';
            
            // Přidat názvy dnů v týdnu
            const dayNames = ['Po', 'Út', 'St', 'Čt', 'Pá', 'So', 'Ne'];
            dayNames.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                dayEl.style.fontWeight = 'bold';
                calendarEl.appendChild(dayEl);
            });
            
            // Přidat prázdné buňky před první den
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyEl = document.createElement('div');
                emptyEl.classList.add('calendar-day');
                calendarEl.appendChild(emptyEl);
            }
            
            // Přidat dny v měsíci
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('calendar-day');
                dayEl.textContent = day;
                
                const date = new Date(year, month, day);
                if (date.getTime() === today.getTime()) {
                    dayEl.classList.add('current-date');
                }
                
                // Zkontrolovat, zda jsou pro tento den nějaké záznamy
                const hasEntries = workEntries.some(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getFullYear() === year && 
                           entryDate.getMonth() === month && 
                           entryDate.getDate() === day;
                });
                
                if (hasEntries) {
                    dayEl.style.backgroundColor = '#e8f5e9';
                }
                
                dayEl.addEventListener('click', () => selectDate(date));
                calendarEl.appendChild(dayEl);
            }
        }
        
        // Výběr data
        function selectDate(date) {
            selectedDate = new Date(date);
            selectedDate.setHours(0, 0, 0, 0);
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            selectedDateTitleEl.textContent = `Práce pro datum: ${selectedDate.toLocaleDateString('cs-CZ', options)}`;
            
            dayEntriesSectionEl.style.display = 'block';
            renderDayEntries();
        }
        
        // Vypsání záznamů pro vybraný den
        function renderDayEntries() {
            dayEntriesEl.innerHTML = '';
            
            const entriesForDate = workEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                entryDate.setHours(0, 0, 0, 0);
                return entryDate.getTime() === selectedDate.getTime();
            });
            
            if (entriesForDate.length === 0) {
                dayEntriesEl.innerHTML = '<p>Pro tento den nejsou žádné záznamy.</p>';
                return;
            }
            
            entriesForDate.forEach((entry, index) => {
                const entryEl = document.createElement('div');
                entryEl.classList.add('work-entry');
                
                const employeeName = employees[entry.employeeIndex] || 'Neznámý zaměstnanec';
                
                entryEl.innerHTML = `
                    <h4>${employeeName}</h4>
                    <p>${entry.description}</p>
                    <button class="delete" data-index="${index}">Smazat</button>
                `;
                
                dayEntriesEl.appendChild(entryEl);
            });
            
            // Přidání posluchačů pro tlačítka mazání
            document.querySelectorAll('.work-entry .delete').forEach(button => {
                button.addEventListener('click', (e) => {
                    const entryIndex = parseInt(e.target.getAttribute('data-index'));
                    deleteWorkEntry(entryIndex);
                });
            });
        }
        
        // Přidání záznamu práce
        function addWorkEntry() {
            const employeeIndex = parseInt(selectEmployeeEl.value);
            const description = document.getElementById('workDescription').value.trim();
            
            if (employeeIndex >= 0 && description) {
                workEntries.push({
                    date: selectedDate.toISOString(),
                    employeeIndex,
                    description
                });
                
                document.getElementById('workDescription').value = '';
                renderDayEntries();
                renderCalendar();
                saveData();
            }
        }
        
        // Smazání záznamu práce
        function deleteWorkEntry(index) {
            if (confirm('Opravdu chcete smazat tento záznam?')) {
                workEntries.splice(index, 1);
                renderDayEntries();
                renderCalendar();
                saveData();
            }
        }
        
        // Generování reportu
        function generateReport() {
            const employeeIndex = parseInt(reportEmployeeEl.value);
            const weekInput = document.getElementById('reportWeek').value;
            
            if (employeeIndex >= 0 && weekInput) {
                // Získat datumy pro vybraný týden
                const [year, week] = weekInput.split('-W');
                const firstDayOfYear = new Date(year, 0, 1);
                const daysToFirstMonday = firstDayOfYear.getDay() === 0 ? 1 : (8 - firstDayOfYear.getDay()) % 7;
                const firstMonday = new Date(year, 0, 1 + daysToFirstMonday);
                
                const startDate = new Date(firstMonday);
                startDate.setDate(firstMonday.getDate() + (week - 1) * 7);
                
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                
                // Najít záznamy pro vybraného zaměstnance v daném týdnu
                const employeeEntries = workEntries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entry.employeeIndex === employeeIndex && 
                           entryDate >= startDate && 
                           entryDate <= endDate;
                });
                
                // Seřadit záznamy podle data
                employeeEntries.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Vytvořit obsah reportu
                let reportContent = `Týdenní report pro: ${employees[employeeIndex]}\n`;
                reportContent += `Týden: ${weekInput}\n\n`;
                
                // Seskupit záznamy podle data
                const entriesByDate = {};
                employeeEntries.forEach(entry => {
                    const entryDate = new Date(entry.date).toISOString().split('T')[0];
                    if (!entriesByDate[entryDate]) {
                        entriesByDate[entryDate] = [];
                    }
                    entriesByDate[entryDate].push(entry);
                });
                
                // Přidat záznamy do reportu
                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    const dateString = currentDate.toISOString().split('T')[0];
                    
                    const dayNames = ['Pondělí', 'Úterý', 'Středa', 'Čtvrtek', 'Pátek', 'Sobota', 'Neděle'];
                    const dayName = dayNames[i];
                    const formattedDate = currentDate.toLocaleDateString('cs-CZ');
                    
                    reportContent += `${dayName}, ${formattedDate}:\n`;
                    
                    if (entriesByDate[dateString]) {
                        entriesByDate[dateString].forEach(entry => {
                            reportContent += `- ${entry.description}\n`;
                        });
                    } else {
                        reportContent += '- Žádné záznamy\n';
                    }
                    
                    reportContent += '\n';
                }
                
                // Vytvořit a stáhnout soubor
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `report_${employees[employeeIndex]}_${weekInput}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
    </script>
</body>
</html>